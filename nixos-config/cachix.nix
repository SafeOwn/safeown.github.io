# ========================================
# üß© /etc/nixos/cachix.nix
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è Cachix
# –î–æ–±–∞–≤–ª—è–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –∫—ç—à–∏ (substituters) —á–µ—Ä–µ–∑ .nix —Ñ–∞–π–ª—ã –≤ /etc/nixos/cachix/
#
# ‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–æ—Ç —Ñ–∞–π–ª –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢–°–Ø –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `cachix use <name>`
# –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é
# ========================================
{ pkgs, lib, ... }:

let
  # üìÅ –ü–∞–ø–∫–∞, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è .nix —Ñ–∞–π–ª—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∫—ç—à–µ–π
  folder = ./cachix;

  # üîß –§—É–Ω–∫—Ü–∏—è: —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ –ø–∞–ø–∫–µ cachix
  toImport = name: value: folder + ("/" + name);

  # üîç –§–∏–ª—å—Ç—Ä: –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ .nix —Ñ–∞–π–ª—ã (–Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –Ω–µ .git)
  filterCaches = key: value:
    value == "regular" && lib.hasSuffix ".nix" key;

  # üì• –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ .nix —Ñ–∞–π–ª—ã –∏–∑ /etc/nixos/cachix/
  imports = lib.mapAttrsToList toImport (
    lib.filterAttrs filterCaches (builtins.readDir folder)
  );
in
{
  # ========================================
  # üì¶ –ò–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π
  # –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤–∏–¥–∞:
  #   ./cachix/hyprland.nix
  #   ./cachix/chaotic.nix
  #   ./cachix/yazi.nix
  # ========================================
  inherit imports;

  # ========================================
  # üîó –û—Å–Ω–æ–≤–Ω–æ–π –±–∏–Ω–∞—Ä–Ω—ã–π –∫—ç—à NixOS
  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
  # ========================================
  nix.settings.substituters = [
    "https://cache.nixos.org/"
  ];
}
