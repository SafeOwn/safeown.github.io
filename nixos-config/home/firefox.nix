# ========================================
# ü¶ä /etc/nixos/home/firefox.nix
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ Firefox
# –£–ø—Ä–∞–≤–ª—è–µ—Ç:
# - –ü—Ä–æ—Ñ–∏–ª—è–º–∏
# - –ù–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (–≤–∫–ª—é—á–∞—è GPU, –∫—ç—à, –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å)
# - –Ø–∑—ã–∫–æ–≤—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏
# - –ü–æ–ª–∏—Ç–∏–∫–∞–º–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –ø—É—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫)
# –†–∞–±–æ—Ç–∞–µ—Ç —Å KDE, GNOME, Hyprland –∏ –¥—Ä.
# ========================================
{ pkgs, ... }:

{
  programs.firefox = {
    enable = true;  # ‚úÖ –í–∫–ª—é—á–∏—Ç—å Firefox –≤ —Å–∏—Å—Ç–µ–º–µ

    # ========================================
    # üßë –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, work, personal)
    # ========================================
    profiles = {
      "safe" = {
        id = 0;                    # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è
        isDefault = true;          # –î–µ–ª–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        # ========================================
        # ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Firefox (prefs.js)
        # –ü—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —á–µ—Ä–µ–∑ about:config
        # ========================================
        settings = {
          "general.useragent.locale" = "ru";
          "intl.locale.requested" = "ru-RU";



          # üñºÔ∏è –í–∫–ª—é—á–∏—Ç—å –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ (WebRender)

          "gfx.webrender.all" = true; # –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å—Å–∫–æ–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –æ–ø—Ü–∏—é –∏ —É–±—Ä–∞—Ç—å gfx.canvas, media.hardware-video-decoding
#           "gfx.webrender.all" = false;  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GPU –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (—Ç–µ–∫—Å—Ç, CSS, –∞–Ω–∏–º–∞—Ü–∏–∏)
#           "gfx.canvas.azure.backends" = "software";  # –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å software rendering –¥–ª—è canvas | –£—Å–∫–æ—Ä—è–µ—Ç 2D/3D –≥—Ä–∞—Ñ–∏–∫—É
#           "media.hardware-video-decoding.enabled" = false;  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GPU –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ (H.264, VP9, AV1)



          "browser.cache.disk.enable" = false;   # üîΩ –û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ (—ç–∫–æ–Ω–æ–º–∏—Ç SSD, —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É)
          "widget.gtk.global-menu.wayland.enabled" = true;  # üåê –í–∫–ª—é—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –≤ KDE (Wayland)
          "media.av1.enabled" = true; # AV1-–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
        };

        # ========================================
        # üß© –†–∞—Å—à–∏—Ä–µ–Ω–∏—è
        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
        # force = false ‚Üí Nix –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é
        # ========================================
        extensions = {
          force = false;  # ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
        };
      };
    };

    # ========================================
    # üåç –Ø–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä—É—Å—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤
    # ========================================
    languagePacks = [
      "en-US"
      "ru"
    ];

    # ========================================
    # üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ enterprise policies)
    # –ê–Ω–∞–ª–æ–≥ group policy –≤ Windows
    # ========================================
    policies = {
      # üì• –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      DefaultDownloadDirectory = "\${home}/Downloads";

      # üö´ –û—Ç–∫–ª—é—á–∏—Ç—å —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –∏ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
      DisableTelemetry = true;
      DisableFirefoxStudies = true;

      # üö´ –ù–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ Firefox –±—Ä–∞—É–∑–µ—Ä–æ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      DontCheckDefaultBrowser = true;

      # üö´ –û—Ç–∫–ª—é—á–∏—Ç—å Pocket (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É)
      DisablePocket = true;
    };
  };
}
