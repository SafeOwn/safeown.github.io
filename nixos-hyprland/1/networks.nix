{
  ...
}:
{
  # nixpkgs.config.permittedInsecurePackages = [
  #    "openssl"
  # ];

  # NETWORK
  networking = {
    hostName = "pc"; # Define your hostname.
    #iproute2.enable = true;
    wireless.iwd = {
      enable = true;
      # settings = {
      #   General = {
      #     RoamThreshold = -75;
      #     RoamThreshold5G = -80;
      #     RoamRetryInterval = 20;
      #   };
      # };
    };
    useDHCP = false;
    useNetworkd = true;
    firewall = {
      enable = true;
      allowedTCPPorts = [
        # 51820
        # 51821
        443
        80
      ];
      allowedUDPPorts = [
        41641
        3478
      ];
    };
    wg-quick.interfaces."WARP" = {
      type = "amneziawg";
      autostart = false;

      privateKey = "/GgY1xx0NC0qpCUEykiX+Lx6m2gaVmLYsYfQ7Jjc8vA=";
      extraOptions = {
        Jc = 3;
        Jmin = 10;
        Jmax = 50;
        S1 = 88;
        S2 = 36;
        H1 = 1705320866;
        H2 = 1350127700;
        H3 = 1590394911;
        H4 = 1326598777;
      };
      mtu = 1280;
      address = [
        "10.8.123.123/32"
        # "172.16.0.2"
        # "2606:4700:110:8443:4adf:44e5:732b:f054"
      ];
      dns = [
        "8.8.8.8"
        "8.8.4.4"
        # "1.1.1.1"
        # "2606:4700:4700::1111"
        # "1.0.0.1"
        # "2606:4700:4700::1001"
      ];

      peers = [
        {
          publicKey = "AGFbR5G28w9N0BRTSEaL8gz89TjICc4/NDnSdRdCQh0=";
          presharedKey = "9be/kiwXJzI73GxXeL+vKY+qqPT7AO3UjYEzLvNp8ao=";
          allowedIPs = [
            "8.8.8.8/32"
            "8.8.4.4/32"
            "130.255.77.28/32"
            "76.76.21.0/24"
            "157.90.23.135/32"
            "65.109.136.246/32"
            "198.49.23.144/30"
            "198.185.159.144/30"
            "78.47.83.246/32"
            "162.159.153.4/32"
            "162.159.152.4/32"
            "176.119.200.0/24"
            "185.205.70.0/24"
            "185.70.40.0/22"
            "95.216.163.36/32"
            "116.202.120.165/32"
            "116.202.120.166/32"
            "204.8.99.144/32"
            "204.8.99.146/32"
            "10.8.0.1/32"
            "2.16.0.0/13"
            "23.0.0.0/12"
            "23.32.0.0/11"
            "23.64.0.0/14"
            "23.192.0.0/11"
            "84.53.128.0/18"
            "88.221.68.0/22"
            "92.122.0.0/15"
            "95.100.64.0/20"
            "96.16.0.0/15"
            "104.64.0.0/10"
            "172.104.0.0/15"
            "184.24.0.0/13"
            "184.50.0.0/15"
            "184.84.0.0/14"
            "3.0.0.0/9"
            "3.128.0.0/9"
            "13.24.0.0/13"
            "13.32.0.0/12"
            "13.48.0.0/13"
            "13.56.0.0/14"
            "15.184.0.0/14"
            "15.236.0.0/15"
            "18.128.0.0/9"
            "23.20.0.0/14"
            "34.192.0.0/10"
            "35.71.64.0/18"
            "35.160.0.0/12"
            "35.176.0.0/13"
            "44.192.0.0/10"
            "50.16.0.0/14"
            "52.0.0.0/10"
            "52.64.0.0/12"
            "52.84.0.0/14"
            "52.88.0.0/15"
            "52.92.0.0/17"
            "52.192.0.0/12"
            "52.208.0.0/13"
            "52.216.0.0/15"
            "52.220.0.0/15"
            "52.222.0.0/16"
            "52.223.0.0/17"
            "52.223.128.0/18"
            "54.64.0.0/11"
            "54.144.0.0/12"
            "54.160.0.0/11"
            "54.192.0.0/12"
            "54.208.0.0/13"
            "54.220.0.0/15"
            "54.224.0.0/11"
            "65.8.0.0/14"
            "75.2.0.0/17"
            "75.101.128.0/17"
            "98.80.0.0/12"
            "100.24.0.0/13"
            "107.20.0.0/14"
            "108.136.0.0/14"
            "108.156.0.0/14"
            "143.204.0.0/16"
            "216.137.32.0/19"
            "18.164.0.0/14"
            "16.170.0.0/15"
            "159.69.113.242/32"
            "79.133.126.103/32"
            "161.35.79.114/32"
            "176.9.54.72/32"
            "5.181.161.78/32"
            "181.215.69.237/32"
            "128.199.35.122/32"
            "92.113.16.0/21"
            "173.245.48.0/20"
            "103.21.244.0/22"
            "103.22.200.0/22"
            "103.31.4.0/22"
            "141.101.64.0/18"
            "108.162.192.0/18"
            "190.93.240.0/20"
            "188.114.96.0/20"
            "197.234.240.0/22"
            "198.41.128.0/17"
            "162.158.0.0/15"
            "104.16.0.0/13"
            "104.24.0.0/14"
            "172.64.0.0/13"
            "131.0.72.0/22"
            "1.1.1.1/32"
            "1.0.0.1/32"
            "3.160.0.0/14"
            "13.216.0.0/13"
            "13.224.0.0/24"
            "13.248.208.0/20"
            "18.64.0.0/10"
            "52.84.0.0/15"
            "52.222.128.0/17"
            "54.144.0.0/12"
            "54.160.0.0/11"
            "54.192.0.0/12"
            "54.208.0.0/13"
            "54.216.0.0/14"
            "54.220.0.0/15"
            "65.9.0.0/17"
            "76.223.0.0/17"
            "99.86.0.0/16"
            "108.138.0.0/15"
            "108.156.0.0/14"
            "23.227.32.0/19"
            "35.192.0.0/11"
            "66.22.192.0/18"
            "69.162.64.0/18"
            "138.128.136.0/21"
            "204.11.56.0/23"
            "5.200.14.0/24"
            "23.235.32.0/20"
            "43.249.72.0/22"
            "103.244.50.0/24"
            "103.245.222.0/23"
            "103.245.224.0/24"
            "104.156.80.0/20"
            "140.248.64.0/18"
            "140.248.128.0/17"
            "146.75.0.0/16"
            "151.101.0.0/16"
            "157.52.64.0/18"
            "167.82.0.0/17"
            "167.82.128.0/20"
            "167.82.160.0/20"
            "167.82.224.0/20"
            "172.111.64.0/18"
            "185.31.16.0/22"
            "199.27.72.0/21"
            "199.232.0.0/16"
            "104.154.0.0/15"
            "104.196.0.0/14"
            "104.237.160.0/19"
            "107.167.160.0/19"
            "107.178.192.0/18"
            "108.170.192.0/18"
            "108.177.0.0/17"
            "108.59.80.0/20"
            "130.211.0.0/16"
            "136.124.0.0/15"
            "136.22.160.0/20"
            "136.22.176.0/21"
            "136.22.184.0/23"
            "136.22.186.0/24"
            "142.250.0.0/15"
            "146.148.0.0/17"
            "152.65.208.0/22"
            "152.65.214.0/23"
            "152.65.218.0/23"
            "152.65.222.0/23"
            "152.65.224.0/19"
            "162.120.128.0/17"
            "162.216.148.0/22"
            "162.222.176.0/21"
            "172.110.32.0/21"
            "172.217.0.0/16"
            "172.253.0.0/16"
            "173.194.0.0/16"
            "173.255.112.0/20"
            "192.158.28.0/22"
            "192.178.0.0/15"
            "193.186.4.0/24"
            "199.192.112.0/22"
            "199.223.232.0/21"
            "199.36.154.0/23"
            "199.36.156.0/24"
            "207.223.160.0/20"
            "208.117.224.0/19"
            "208.65.152.0/22"
            "208.68.108.0/22"
            "208.81.188.0/22"
            "209.85.128.0/17"
            "216.239.32.0/19"
            "216.58.192.0/19"
            "216.73.80.0/20"
            "23.236.48.0/20"
            "23.251.128.0/19"
            "34.0.0.0/15"
            "34.128.0.0/10"
            "34.16.0.0/12"
            "34.2.0.0/16"
            "34.3.0.0/23"
            "34.3.16.0/20"
            "34.32.0.0/11"
            "34.3.3.0/24"
            "34.3.32.0/19"
            "34.3.4.0/24"
            "34.3.64.0/18"
            "34.3.8.0/21"
            "34.4.0.0/14"
            "34.64.0.0/10"
            "34.8.0.0/13"
            "35.184.0.0/13"
            "35.192.0.0/14"
            "35.196.0.0/15"
            "35.198.0.0/16"
            "35.199.0.0/17"
            "35.199.128.0/18"
            "35.200.0.0/13"
            "35.208.0.0/12"
            "35.224.0.0/12"
            "35.240.0.0/13"
            "57.140.192.0/18"
            "64.15.112.0/20"
            "64.233.160.0/19"
            "66.102.0.0/20"
            "66.22.228.0/23"
            "66.249.64.0/19"
            "70.32.128.0/19"
            "72.14.192.0/18"
            "74.125.0.0/16"
            "8.34.208.0/20"
            "8.35.192.0/20"
            "8.8.4.0/24"
            "8.8.8.0/24"
            "103.20.92.0/24"
            "103.20.93.0/24"
            "103.20.94.0/24"
            "103.20.95.0/24"
            "108.174.0.0/24"
            "108.174.10.0/24"
            "108.174.1.0/24"
            "108.174.13.0/24"
            "108.174.14.0/24"
            "108.174.15.0/24"
            "108.174.2.0/24"
            "108.174.3.0/24"
            "108.174.4.0/24"
            "108.174.5.0/24"
            "108.174.6.0/24"
            "108.174.7.0/24"
            "108.174.8.0/24"
            "144.2.12.0/24"
            "144.2.13.0/24"
            "144.2.14.0/24"
            "144.2.15.0/24"
            "144.2.16.0/24"
            "144.2.177.0/24"
            "144.2.178.0/24"
            "144.2.180.0/24"
            "144.2.181.0/24"
            "144.2.182.0/24"
            "144.2.183.0/24"
            "144.2.185.0/24"
            "144.2.22.0/24"
            "144.2.225.0/24"
            "144.2.226.0/24"
            "144.2.229.0/24"
            "144.2.230.0/24"
            "144.2.23.0/24"
            "144.2.233.0/24"
            "144.2.234.0/24"
            "144.2.235.0/24"
            "144.2.237.0/24"
            "144.2.238.0/24"
            "144.2.239.0/24"
            "144.2.9.0/24"
            "216.52.16.0/24"
            "216.52.18.0/24"
            "216.52.19.0/24"
            "216.52.20.0/24"
            "216.52.22.0/24"
            "216.52.23.0/24"
            "45.42.64.0/24"
            "45.42.66.0/24"
            "31.13.24.0/21"
            "31.13.64.0/18"
            "45.64.40.0/22"
            "57.144.0.0/14"
            "66.220.144.0/20"
            "69.63.176.0/20"
            "69.171.224.0/19"
            "74.119.76.0/22"
            "102.132.96.0/20"
            "103.4.96.0/22"
            "129.134.0.0/16"
            "147.75.208.0/20"
            "157.240.0.0/16"
            "163.70.128.0/17"
            "163.77.128.0/17"
            "173.252.64.0/18"
            "179.60.192.0/22"
            "185.60.216.0/22"
            "204.15.20.0/22"
            "87.245.208.0/21"
            "3.33.221.48/32"
            "3.33.252.61/32"
            "15.197.206.217/32"
            "15.197.210.208/32"
            "34.192.181.12/32"
            "34.193.38.112/32"
            "34.194.71.217/32"
            "34.194.255.230/32"
            "13.104.0.0/14"
            "20.192.0.0/10"
            "40.120.0.0/14"
            "20.64.0.0/10"
            "193.46.255.29/32"
            "185.199.108.0/22"
            "135.181.0.0/16"
            "95.217.0.0/16"
            "51.15.0.0/17"
            "49.12.0.0/15"
            "179.43.128.0/18"
            "95.215.189.11/32"
            "95.215.189.12/32"
            "62.102.151.70/32"
            "178.248.237.68/32"
            "95.216.247.245/32"
            "51.77.117.40/32"
            "142.132.196.168/32"
            "145.239.67.120/32"
            "192.0.64.0/18"
            "69.163.179.95/32"
            "178.62.193.42/32"
            "79.133.57.42/32"
            "64.227.45.125/32"
            "195.245.213.0/24"
            "5.187.1.247/32"
            "212.227.190.190/32"
            "34.174.206.169/32"
            "194.55.16.0/20"
            "162.19.86.111/32"
            "54.37.161.241/32"
            "94.23.153.55/32"
            "54.37.254.125/32"
            "57.128.118.202/32"
            "51.83.70.134/32"
            "76.76.21.98/32"
            "76.76.21.22/32"
            "199.59.243.228/32"
            "195.201.98.243/32"
            "150.136.81.100/32"
            "135.181.131.152/32"
            "65.108.205.203/32"
            "185.151.30.191/32"
            "217.197.98.200/32"
            "178.210.92.7/32"
            "135.125.166.162/32"
            "84.32.84.217/32"
            "153.92.218.246/32"
            "31.172.76.107/32"
            "192.124.249.174/32"
            "159.203.155.10/32"
            "185.152.212.205/32"
            "51.210.183.181/32"
            "185.71.67.84/32"
            "185.152.212.221/32"
            "78.46.76.74/32"
            "37.9.175.156/32"
            "80.87.96.153/32"
            "65.109.25.28/32"
            "77.83.173.48/32"
            "62.122.170.217/32"
            "85.192.30.41/32"
            "34.54.84.66/32"
            "207.241.224.2/32"
            "75.2.60.5/32"
            "75.2.70.75/32"
            "99.83.190.102/32"
            "194.55.16.0/20"
            "138.201.31.4/32"
            "88.99.63.118/32"
            "94.130.50.88/32"
            "94.130.88.238/32"
            "138.201.250.73/32"
            "94.130.217.223/32"
            "23.227.32.0/19"
            "64.63.0.0/18"
            "68.232.34.0/24"
            "69.12.56.0/21"
            "69.195.160.0/19"
            "93.184.220.0/22"
            "103.252.112.0/22"
            "104.244.40.0/21"
            "152.192.0.0/13"
            "185.45.4.0/22"
            "188.64.224.0/21"
            "192.44.69.0/24"
            "192.48.236.0/23"
            "192.133.76.0/22"
            "192.229.220.0/24"
            "192.229.233.0/24"
            "199.16.156.0/22"
            "199.59.148.0/22"
            "199.69.58.0/23"
            "199.96.56.0/21"
            "202.160.128.0/22"
            "209.237.192.0/19"
            "95.213.180.0/23"
            "136.143.176.0/20"
            "139.162.0.0/16"
            "152.228.128.0/17"
            "185.53.177.0/24"
            "194.90.0.0/16"
            "199.60.103.0/24"
            "204.141.0.0/16"
            "216.198.0.0/18"
            "185.37.238.0/24"
            "194.124.204.0/24"
            "194.124.204.0/22"
            "194.124.205.0/24"
            "194.124.206.0/23"
            "195.180.152.0/22"

            # "0.0.0.0/0"
            # "::/0"
          ];
          endpoint = "54.38.46.128:38313";
          persistentKeepalive = 25;
        }
      ];
    };
  };
  services = {
    openssh.enable = true;
    resolved = {
      enable = true;
      dnsovertls = "true";
      # resolved.extraConfig = '''';
    };

    zapret = {
      enable = false;
      udpSupport = true;
      udpPorts = [
        "50000:50099"
      ];
      params = [
        "--dpi-desync=fake,disorder2"
        "--dpi-desync-ttl=1"
        "--dpi-desync-autottl=2"
        "--dpi-desync=fake,tamper"
        "--dpi-desync-repeats=6"
        "--dpi-desync-any-protocol"
        "--dpi-desync=split"
        "--dpi-desync-ttl=5"
        "--dpi-desync-fooling=badsum"
      ];
      whitelist = [
        "youtube.com"
        "googlevideo.com"
        "ytimg.com"
        "youtu.be"
        "vid.puffyan.us"
      ];

    };
  };
  systemd.network = {
    enable = true;
    wait-online = {
      enable = false;
      anyInterface = true;
    };
    networks."20-wlan0" = {
      matchConfig = {
        Type = "wlan";
        WLANInterfaceType = "station";
      };
      networkConfig = {
        DHCP = true;
      };
      dhcpV4Config = {
        UseDNS = false;
      };
      dhcpV6Config = {
        UseDNS = false;
      };
      linkConfig.RequiredForOnline = false;
      ipv6AcceptRAConfig.UseDNS = false;
    };
  };

  # networking.firewall = {
  #   enable = true;
  #   allowedTCPPorts = [
  #     51820
  #     51821
  #   ];
  #   #allowedUDPPorts = [ ... ];
  # };
  # Network configuration with NEXTDNS/DNS

  # networking.firewall.checkReversePath = "loose";
  # Enables DHCP on each ethernet and wireless interface. In case of scripted networking
  # (the default) this is the recommended approach. When using systemd-networkd it's
  # still possible to use this option, but it's recommended to use it in conjunction
  # with explicit per-interface declarations with `networking.interfaces.<interface>.useDHCP`.
  # networking.useDHCP = lib.mkDefault true;
  # networking.interfaces.wlp6s0.useDHCP = lib.mkDefault true;

}
